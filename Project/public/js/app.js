function encodeForAjax(e){return null==e?null:Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")}function sendAjaxRequest(e,t,o){let n=new XMLHttpRequest;n.open(e,t,!0),n.setRequestHeader("X-CSRF-TOKEN",document.querySelector('meta[name="csrf-token"]').content),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send(encodeForAjax(o))}function sendSyncAjaxRequest(e,t,o){let n=new XMLHttpRequest;n.open(e,t,!1),n.setRequestHeader("X-CSRF-TOKEN",document.querySelector('meta[name="csrf-token"]').content),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send(encodeForAjax(o))}function getCSRF(){let e=document.createElement("input");return e.type="hidden",e.name="_token",e.value=document.querySelector("head meta[name='csrf-token']").content,e}function editPost(e){let t=document.querySelector("#post"+e).querySelector("main"),o=t.querySelector("#main-content");t.querySelector("img.postmedia");let n=t.querySelector("h3.postvisibility"),r=t.querySelector("h3.postcontent"),a=document.createElement("textarea");a.type="textbox",a.className="postcontent",a.value=null===r?"":parseContentEdit(r.innerHTML),o.insertBefore(a,r);let c=document.createElement("input");c.checked="public"==n.innerHTML,c.type="checkbox",c.className="visibilityCheck";let s=document.createElement("label");s.innerHTML="Public Post?",s.className="checkLabel",s.appendChild(c),o.insertBefore(s,r),null!==r&&o.removeChild(r),document.querySelector("#cancelEditPost"+e).style.visibility="visible";let l=document.querySelector("#editPost"+e).querySelector("#text-icon");l.classList.remove("fa-pencil"),l.classList.add("fa-floppy-o");document.querySelector("#editPost"+e).onclick=()=>{sendEditPost(e)}}async function sendEditPost(e){let t=document.querySelector("#post"+e).querySelector("main"),o=t.querySelector("#main-content"),n=t.querySelector("img.postmedia"),r=t.querySelector("input.visibilityCheck"),a=t.querySelector("textarea.postcontent"),c=await parseContentSend(a.value);if(""==(c=c.replace("\n","<br />"))&&null==n){alert("Empty post. Please try again.");return}if(c.length>255){alert("Post max: 255. Please try again.");return}sendAjaxRequest("post","../post/edit",{id:e,content:a.value,is_public:r.checked}),t.querySelector("h3.postvisibility").innerHTML=r.checked?"public":"private",t.querySelector(".checkLabel").remove();let s=document.createElement("h3");s.innerHTML=c,s.className="postcontent",o.insertBefore(s,o.firstChild),a.remove(),document.querySelector("#cancelEditPost"+e).style.visibility="hidden";let l=document.querySelector("#editPost"+e).querySelector("#text-icon");l.classList.remove("fa-floppy-o"),l.classList.add("fa-pencil");document.querySelector("#editPost"+e).onclick=()=>{editPost(e)}}function cancelEditPost(){window.location.reload()}function createPost(e){let t=document.querySelector("#alert");t&&t.remove();let o=document.querySelector("#createPostModal");if(o.hidden=!1,null!=e){let n=document.createElement("input");n.hidden=!0,n.value=e,n.name="group_id",o.querySelector("form").appendChild(n)}}function createGroup(){let e=document.querySelector("#alert");e&&e.remove();document.querySelector("#createPostModal").hidden=!1}function blockUser(e){"Unblock"==document.querySelector("#block"+e).innerHTML?(sendAjaxRequest("post","../admin/user/unblock",{id:e}),document.querySelector("#block"+e).innerHTML="Block"):(sendAjaxRequest("post","../admin/user/block",{id:e}),document.querySelector("#block"+e).innerHTML="Unblock")}function deletePost(e,t){sendAjaxRequest("post","../post/delete",{id:e}),document.querySelector("#post"+e).remove(),updateStatistics(-1,t),updateStatistics(-1,"postResults")}function deleteMessage(){document.querySelector("#alert").remove()}function deleteUser(e,t){"profile"==t?document.querySelector("#delete-user-form-button").click():(sendAjaxRequest("post","../user/delete",{id:e}),document.querySelector("#user"+e).remove(),updateStatistics(-1,t))}function getProfileImage(e){let t="../images/profile/"+e+".jpg";var o=new XMLHttpRequest;return o.open("HEAD",t,!1),o.send(),"404"==o.status?"../images/profile/default.jpg":t}function updateStatistics(e,t){let o=document.getElementById(t);if(o){let n=parseInt(o.innerHTML.match(/\d+/g)[0])+e;o.innerHTML=o.innerHTML.replace(/\d+/g,n)}}function updateStatisticsHTML(e,t){let o=document.getElementById(t);if(o){let n=parseInt(o.querySelector("h4").innerHTML.match(/\d+/g)[0])+e;o.querySelector("h4").innerHTML=o.querySelector("h4").innerHTML.replace(/\d+/g,n)}}function showRecoverPassword(){document.querySelector("#recover").hidden=!1,document.querySelector("#recoverButton").remove()}function recoverPassword(){let e=document.querySelector("#recoverEmail").value;if(""==e){alert("Empty email. Please try again.");return}document.querySelector("#recoverAttemp").value=e,sendAjaxRequest("post","../sendEmail",{email:e}),document.querySelector("#recover").hidden=!0,document.querySelector("#recoverPassword").hidden=!1}function removeFollower(e){sendAjaxRequest("post","removeFollower",{id:e}),updateStatistics(-1,"userFollowers"),document.querySelector("#follower"+e).remove()}function removeFollow(e){sendAjaxRequest("post","unfollow",{id:e}),updateStatistics(-1,"userFollowing"),document.querySelector("#followed"+e).remove()}function updateState(e,t,o){let n=document.querySelector("#state"+e).innerHTML.replace(/\s/g,""),r=n.replace(/(<([^>]+)>)/ig,"");switch(console.log(r),r){case"Follow":if(o){sendAjaxRequest("post","follow",{id:e}),document.querySelector("#state"+e).innerHTML='<i id="text-icon" class="fa fa-minus-circle" aria-hidden="true"></i> Unfollow',updateStatistics(1,"userFollowers");let a=document.createElement("article");a.className="user-admin-result follow-person-card",a.id="follower"+t;let c=document.createElement("img");c.src=getProfileImage(t),c.className="user-profile-pic",a.appendChild(c);let s=document.createElement("a");s.href="../user/"+t;let l=document.createElement("h2");l.className="user-username profile-follow-card-user",l.innerHTML=document.getElementById("user="+t).innerHTML,s.appendChild(l),a.appendChild(s);let u=document.createElement("h3");u.className="group-follow-card-username",u.innerHTML=document.querySelector("#username"+t).innerHTML,a.appendChild(u);let d=document.querySelector("#followers");d.insertBefore(a,d.firstChild)}else sendAjaxRequest("post","doFollowRequest",{id:e}),document.querySelector("#state"+e).innerHTML='<i id="text-icon" class="fa fa-times-circle" aria-hidden="true"></i> Cancel follow request';break;case"Unfollow":sendAjaxRequest("post","unfollow",{id:e}),document.querySelector("#state"+e).innerHTML='<i id="text-icon" class="fa fa-plus-circle" aria-hidden="true"></i> Follow';let p=document.querySelector("#follower"+t);p&&p.remove(),updateStatistics(-1,"userFollowers");break;case"Cancelfollowrequest":sendAjaxRequest("post","cancelFollowRequest",{id:e}),document.querySelector("#state"+e).innerHTML='<i id="text-icon" class="fa fa-plus-circle" aria-hidden="true"></i> Follow'}}function acceptRequestFollow(e,t){sendAjaxRequest("post","../user/acceptFollowRequest",{id:e});let o=document.querySelector("#notification"+t+" > h3");o.innerHTML=o.innerHTML.replace("request","started"),document.querySelector(".request").remove(),document.querySelector(".request").remove();let n=document.createElement("button");n.innerHTML="X",n.className="notification-button",n.onclick=()=>removeNotification(t),document.querySelector("#notification"+t).appendChild(n)}function rejectRequestFollow(e,t){sendAjaxRequest("post","../user/rejectFollowRequest",{id:e}),document.querySelector("#notification"+t).remove()}function removeNotification(e){sendAjaxRequest("post","../notification/delete",{id:e}),document.querySelector("#notification"+e).remove()}function likePost(e){let t=document.querySelector("#countPostLikes"+e),o=t.querySelector("#text-config"),n=parseInt(o.innerHTML.match(/^[^\d]*(\d+)/g)),r=t.querySelector("#text-icon");"button-post-comment button-outline-post-comment"==t.className?(sendAjaxRequest("post","../post/dislike",{id:e}),console.log("deu dislike"),t.className="button-post-comment",r.classList.remove("fa-heart"),r.classList.add("fa-heart-o"),o.innerHTML=o.innerHTML.replace(/^[^\d]*(\d+)/g,n-1)):(sendAjaxRequest("post","../post/like",{id:e}),console.log("deu like"),t.className="button-post-comment button-outline-post-comment",r.classList.remove("fa-heart-o"),r.classList.add("fa-heart"),o.innerHTML=o.innerHTML.replace(/^[^\d]*(\d+)/g,n+1))}function likeComment(e){let t=document.querySelector("#countCommentLikes"+e),o=t.querySelector("#text-config"),n=parseInt(o.innerHTML.match(/^[^\d]*(\d+)/g)),r=t.querySelector("#text-icon");"button-post-comment button-outline-post-comment"==t.className?(sendAjaxRequest("post","../comment/dislike",{id:e}),t.className="button-post-comment",r.classList.remove("fa-heart"),r.classList.add("fa-heart-o"),o.innerHTML=o.innerHTML.replace(/^[^\d]*(\d+)/g,n-1)):(sendAjaxRequest("post","../comment/like",{id:e}),t.className="button-post-comment button-outline-post-comment",r.classList.remove("fa-heart-o"),r.classList.add("fa-heart"),o.innerHTML=o.innerHTML.replace(/^[^\d]*(\d+)/g,n+1))}async function getNotifications(e){let t=await fetch("../api/notifications?type="+e);return t.text()}async function getMessages(e){let t=await fetch("../api/messages?id="+e);return t.text()}async function updateMessages(){let e=parseInt(window.location.pathname.toString().match(/\d+/g)[0]),t=document.getElementById("msg-page-messages-container"),o=await getMessages(e),n=t.scrollTop+t.clientHeight==t.scrollHeight;o.length>10&&(t.innerHTML=t.innerHTML+o),n&&chatScrollBottom()}async function updateNotifications(){document.querySelector("#notification_content")&&(document.querySelector("#user_notifications").innerHTML=await getNotifications("user"),document.querySelector("#post_notifications").innerHTML=await getNotifications("post"),document.querySelector("#comment_notifications").innerHTML=await getNotifications("comment"),document.querySelector("#group_notifications").innerHTML=await getNotifications("group"),updateTotal((document.querySelector("#user_notifications").innerHTML.match(/<article/g)||[]).length,"button_user_notifications"),updateTotal((document.querySelector("#post_notifications").innerHTML.match(/<article/g)||[]).length,"button_post_notifications"),updateTotal((document.querySelector("#comment_notifications").innerHTML.match(/<article/g)||[]).length,"button_comment_notifications"),updateTotal((document.querySelector("#group_notifications").innerHTML.match(/<article/g)||[]).length,"button_group_notifications")),document.querySelector(".notificationspagebutton")&&(document.querySelector(".notificationspagebutton").innerHTML=await getNotifications("all"))}function updateGroupState(e,t,o){let n=document.querySelector("#groupState"+e).innerHTML.replace(/\s/g,""),r=n.replace(/(<([^>]+)>)/ig,"");switch(r){case"JoinGroup":if(o){sendAjaxRequest("post","join",{group_id:e}),document.querySelector("#groupState"+e).innerHTML='<i id="text-icon" class="fa fa-minus-circle" aria-hidden="true"></i> Leave Group',updateStatistics(1,"groupMembers");let a=document.createElement("article");a.className="member-person-card",a.id="group-member-"+t;let c=document.createElement("img");c.src=getProfileImage(t),c.className="user-profile-pic",a.appendChild(c);let s=document.createElement("a");s.href="../user/"+t;let l=document.createElement("h2");l.className="user-username group-follow-card-user",l.innerHTML=document.getElementById("user="+t).innerHTML,s.appendChild(l),a.appendChild(s);let u=document.createElement("h3");u.className="group-follow-card-username",u.innerHTML=document.querySelector("#username"+t).innerHTML,a.appendChild(u);let d=document.querySelector("#group-members");d.insertBefore(a,d.firstChild)}else sendAjaxRequest("post","doJoinRequest",{group_id:e}),document.querySelector("#groupState"+e).innerHTML='<i id="text-icon" class="fa fa-times-circle" aria-hidden="true"></i> Cancel join request';break;case"LeaveGroup":sendAjaxRequest("post","leave",{group_id:e}),document.querySelector("#groupState"+e).innerHTML='<i id="text-icon" class="fa fa-plus-circle" aria-hidden="true"></i> Join Group';let p=document.querySelector("#group-member-"+t);p&&p.remove(),updateStatistics(-1,"groupMembers");break;case"Canceljoinrequest":sendAjaxRequest("post","cancelJoinRequest",{group_id:e}),document.querySelector("#groupState"+e).innerHTML='<i id="text-icon" class="fa fa-plus-circle" aria-hidden="true"></i> Join Group'}}async function getAPIResult(e,t){let o=await fetch("../api/"+e+"?search="+t);return o.text()}function acceptJoinRequest(e,t,o){sendAjaxRequest("post","../group/acceptJoinRequest",{user_id:e,group_id:t});let n=document.querySelector("#notification"+o+" > h3");n.innerHTML=n.innerHTML.replace("requested","started"),document.querySelector(".request").remove(),document.querySelector(".request").remove();let r=document.createElement("button");r.innerHTML="X",r.className="notification-button",r.onclick=()=>removeNotification(o),document.querySelector("#notification"+o).appendChild(r)}function rejectJoinRequest(e,t,o){sendAjaxRequest("post","../group/rejectJoinRequest",{user_id:e,group_id:t}),document.querySelector("#notification"+o).remove()}function acceptInviteRequest(e,t){sendAjaxRequest("post","../group/acceptInvite",{group_id:e}),document.querySelector("#notification"+t+" h3.notification-message").innerHTML=document.querySelector("#notification"+t+" h3.notification-message").innerHTML.replace("invited you to join group","you are now member of"),document.querySelector(".request").remove(),document.querySelector(".request").remove();let o=document.createElement("button");o.innerHTML="X",o.className="notification-button",o.onclick=()=>removeNotification(t),document.querySelector("#notification"+t).appendChild(o)}function rejectInviteRequest(e,t){sendAjaxRequest("post","../group/rejectInvite",{group_id:e}),document.querySelector("#notification"+t).remove()}function showComments(e,t){let o=document.querySelector("#"+t+e+" footer");o.hidden?o.hidden=!1:o.hidden=!0}function deleteComment(e,t){sendAjaxRequest("post","../comment/delete",{id:e}),document.querySelector("#comment"+e).remove(),document.querySelector(".subcomment"+e)&&document.querySelector(".subcomment"+e).remove(),"commentResults"===t?updateStatistics(-1,t):updateStatisticsHTML(-1,t)}function reply(e){let t=document.querySelector("#owner"+e).parentElement,o=document.querySelector("#owner"+e).innerHTML,n=t.parentElement.parentElement.lastElementChild;console.log(n),n.querySelector("#content-textarea").value.match("@"+o)||(""===n.querySelector("#content-textarea").value?n.querySelector("#content-textarea").value="@"+o:n.querySelector("#content-textarea").value=n.querySelector("#content-textarea").value+" @"+o)}function updateTotal(e,t){let o=document.getElementById(t);o&&(o.innerHTML=o.innerHTML.replace(/\d+/g,e))}function removeGroupMember(e,t){sendAjaxRequest("post","/group/removeMember",{group_id:e,member_id:t}),document.querySelector("#group-member-"+t).remove(),updateStatistics(-1,"groupMembers")}function inviteToGroup(){document.querySelector(".inviteToGroup").style.visibility="visible",document.querySelector("#close-button").onclick=function(){document.querySelector(".inviteToGroup").style.visibility="hidden"}}async function sendEditComment(e){let t=document.querySelector("#comment"+e),o=t.querySelector("#main-content"),n=t.querySelector("textarea"),r=await parseContentSend(n.value);if(r=r.replace("\n","<br />"),""==n.value){alert("Empty comment. Please try again.");return}if(r.length>255){alert("Large comment. Please try again.");return}sendAjaxRequest("post","../comment/edit",{id:e,content:n.value});let a=document.createElement("h3");a.className="content",a.innerHTML=r,o.insertBefore(a,n),o.removeChild(n);let c=document.querySelector("#editComment"+e).querySelector("#text-icon");c.classList.remove("fa-floppy-o"),c.classList.add("fa-pencil");document.querySelector("#editComment"+e).onclick=()=>{editComment(e)}}function editComment(e){let t=document.querySelector("#comment"+e).querySelector("#main-content"),o=t.querySelector("h3.content"),n=document.createElement("textarea");n.type="textbox",n.value=parseContentEdit(o.innerHTML),t.insertBefore(n,o),t.removeChild(o);let r=document.querySelector("#editComment"+e).querySelector("#text-icon");r.classList.remove("fa-pencil"),r.classList.add("fa-floppy-o");document.querySelector("#editComment"+e).onclick=()=>{sendEditComment(e)}}function inviteState(e,t){let o=document.querySelector("#inviteGroup"+t);"Cancel Invitation"==o.innerHTML?(sendAjaxRequest("post","../group/cancelInvite",{user_id:e,group_id:t}),o.innerHTML="Invite"):(sendAjaxRequest("post","../group/invite",{user_id:e,group_id:t}),o.innerHTML="Cancel Invitation")}function favorite(e){let t=document.querySelector("#fav"+e);"group-interaction-button fa fa-star"==t.className?(sendAjaxRequest("post","../group/unfavorite",{id:e}),t.className="group-interaction-button fa fa-star-o"):(sendAjaxRequest("post","../group/favorite",{id:e}),t.className="group-interaction-button fa fa-star")}async function search(e){document.querySelector("#results-posts").innerHTML=await getAPIResult("post",e),document.querySelector("#results-users").innerHTML=await getAPIResult("user",e),document.querySelector("#results-groups").innerHTML=await getAPIResult("group",e),document.querySelector("#results-comments").innerHTML=await getAPIResult("comment",e),updateTotal((document.querySelector("#results-posts").innerHTML.match(/class="main-post"/g)||[]).length,"postResults"),updateTotal((document.querySelector("#results-users").innerHTML.match(/<article/g)||[]).length,"userResults"),updateTotal((document.querySelector("#results-groups").innerHTML.match(/<article/g)||[]).length,"groupResults"),updateTotal((document.querySelector("#results-comments").innerHTML.match(/class="comment"/g)||[]).length,"commentResults")}function deleteGroup(e){sendSyncAjaxRequest("post","../group/delete",{id:e}),window.location.href="/groups"}async function parseContentSend(e){async function t(e,t,o){let n=[];e.replace(t,(e,...t)=>{let r=o(e,...t);n.push(r)});let r=await Promise.all(n);return e.replace(t,()=>r.shift())}async function o(e){let t="../api/userVerify?search="+e.replace("@",""),o=await fetch(t).then(e=>e.json());return -1!=o?"<a href='../user/"+o+"'>"+e+"</a>":e}e=e.replace(/(#\w+)/g,"<a href='../home/search?query=$1'>$1</a>");let n=await t(e,/(@\w+)/g,o);return n}function parseContentEdit(e){return e.replace(/(<([^>]+)>)/ig,"")}async function getContext(e,t){let o=await fetch("../api/context?type="+t+"&id="+e);return o.text()}async function showContext(e,t){document.querySelector("#notification_popup").innerHTML=await getContext(e,t)+'<button class="notification-button" onclick="cancelPopup()">X</button>',document.querySelector("#notification_popup").hidden=!1,document.querySelector("#configuration_popup").hidden=!0}function showConfigurations(){document.querySelector("#configuration_popup").hidden=!1,document.querySelector("#notification_popup").hidden=!0}function cancelPopup(){document.querySelector("#notification_popup").hidden=!0,document.querySelector("#configuration_popup").hidden=!0}async function contacts(e){document.querySelector("#results-users").innerHTML=await getAPIResult("user",e),updateTotal((document.querySelector("#results-users").innerHTML.match(/<article/g)||[]).length,"userResults")}function toggleSidebar(){let e=document.querySelector("#sidebar"),t=document.querySelector("#sidebar-toggle-open");"sidebar-hidden"===e.className?(e.className="sidebar-shown",t.hidden=!1,t.classList.add("open-sidebar-button-hidden"),t.classList.remove("open-sidebar-button-shown")):(e.className="sidebar-hidden",t.hidden=!1,t.classList.add("open-sidebar-button-shown"),t.classList.remove("open-sidebar-button-hidden"))}function chatScrollBottom(){let e=document.getElementById("msg-page-messages-container");e.scrollTop=e.scrollHeight}function searchChats(){let e=document.getElementById("sidebar-chat-search").value;e=e.toLowerCase();let t=document.getElementById("sidebar-current-chat-list").getElementsByTagName("article");for(console.log(t),i=0;i<t.length;i++){let o=t[i].querySelector(".chat-person-name"),n=t[i].querySelector(".chat-person-username");o.innerHTML.toLowerCase().includes(e)||n.innerHTML.toLowerCase().includes(e)?t[i].style.display="flex":t[i].style.display="none"}}function submitOnEnter(e){13!==e.which||e.shiftKey||(e.target.form.dispatchEvent(new Event("submit",{cancelable:!0})),e.preventDefault())}function confirmation(e,t){document.getElementById("confirm").addEventListener("click",function(){e(...t)}),document.getElementById("modalEnable").click()}function checkGroupsErrorModal(){document.querySelector("#newgroup h5.error")&&document.getElementById("newgroupmodal").click()}function init(){updateNotifications(),setInterval(updateNotifications,2e3),null!=window.location.toString().match(/message\//g)&&(setInterval(updateMessages,2e3),chatScrollBottom()),checkGroupsErrorModal();let e=document.querySelector("#search");if(e){let t=window.location.toString().match(/query=(.*)$/g);null!=t&&(e.value=t[0].replace("query=",""),search(t[0].replace("query=","").replace("#",""))),e.addEventListener("input",async function(){search(this.value.replace("#",""))})}let o=document.querySelector("#search-contacts");o&&o.addEventListener("input",async function(){contacts(this.value)});let n=document.querySelector("#new-message-form");if(n){let r=n.querySelector("#content-textarea");r&&r.addEventListener("keypress",submitOnEnter)}}init();